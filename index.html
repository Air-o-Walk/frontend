<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air-o-Walk</title>

    <link rel="stylesheet" href="Landing/css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

    <style>
        #map {
            height: 500px;
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            z-index: 1;
        }

        .contact-map-container {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
        }

        /* Estilos para las listas de informaci√≥n */
        #gas-text ul {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        #gas-text li {
            background: #fff;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #A8B870;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #gas-text strong {
            color: #4B4773;
        }
    </style>
</head>

<body>

    <header class="navbar">
        <div class="nav-left">
            <img src="https://sagucre.upv.edu.es/images/260/21639371/Diagramadesitioweb2-tzmgvOszHG8SDcflHZ0HZw.png"
                class="logo-circle" alt="Air-o-walk logo">
        </div>

        <nav class="nav-links">
            <a href="#maps">Mapa</a>
            <a href="#producto">Nuestro Producto</a>
            <a href="#sobre">Sobre nosotros</a>
            <a href="#contacto">Contacto</a>
        </nav>

        <div class="nav-right">
            <button class="btn-signup"
                onclick="window.location.href='https://sagucre.upv.edu.es/descarga/';">Apuntate!</button>
            <a class="login" href="/login/index.html">Login ></a>
        </div>
    </header>


    <section class="hero">
        <img src="assets/hero.png" class="hero-bg" alt="Hero image">

        <div class="hero-content">
            <h1>Respira mejor</h1>
            <p>Entiende tu aire</p>
            <a href="#maps" class="btn-hero">Ver mapa</a>
        </div>
    </section>


    <section id="maps" class="section-map">

        <h2 class="map-title">Mapa en Tiempo Real</h2>
        <p class="map-sub">Gandia, platja de gandia</p>

        <div id="map"></div>

        <div class="gas-tabs">
            <button class="tab active" onclick="showLayer('AirQuality', this)">Calidad Aire</button>
            <button class="tab" onclick="showLayer('O3', this)">O3</button>
            <button class="tab" onclick="showLayer('CO', this)">CO</button>
            <button class="tab" onclick="showLayer('NO2', this)">NO2</button>
        </div>

        <div class="gas-info">
            <h3 id="gas-title">Calidad del Aire</h3>

            <div id="gas-text">
                <p>El sistema muestra datos en tiempo real de los sensores distribuidos por la ciudad combinando todos
                    los contaminantes.</p>
                <ul>
                    <li><strong>üü¢ Buena:</strong> Disfruta de tus actividades al aire libre.</li>
                    <li><strong>üü° Moderada:</strong> Personas sensibles deben reducir esfuerzos.</li>
                    <li><strong>üü† Mala / üî¥ Muy Mala:</strong> Evita actividades f√≠sicas en el exterior.</li>
                </ul>
            </div>

            <button class="btn-signup map-btn"
                onclick="window.location.href='https://sagucre.upv.edu.es/descarga/';">¬°Descarga la App!</button>
        </div>

    </section>


    <section id="producto" class="section-producto">
        <div class="producto-wrapper">
            <img src="https://sagucre.upv.edu.es/images/260/21639371/Diagramadesitioweb2-tzmgvOszHG8SDcflHZ0HZw.png"
                class="producto-lamp" alt="Logo">
            <div class="producto-content">
                <h2 class="section-title orange center">Nuestro Producto</h2>
                <p class="producto-desc center">
                    Air-o-Walk es una plataforma que combina sensores ambientales, mapas inteligentes y contenido
                    educativo
                    para que cualquier ciudadano pueda entender en tiempo real la calidad del aire que respira.
                </p>
                <div class="producto-grid">
                    <div class="feature-v">
                        <i class="fa-solid fa-map-location-dot icon-feature"></i>
                        <h4>Mapas en tiempo real</h4>
                        <p>Visualiza la calidad del aire con heatmaps precisos.</p>
                    </div>
                    <div class="feature-v">
                        <i class="fa-solid fa-book-open icon-feature"></i>
                        <h4>Educaci√≥n integrada</h4>
                        <p>Fichas simples con causas y consejos pr√°cticos.</p>
                    </div>
                    <div class="feature-v">
                        <i class="fa-solid fa-route icon-feature"></i>
                        <h4>Alertas y Rutas</h4>
                        <p>Recibe avisos y encuentra caminos con menor exposici√≥n.</p>
                    </div>
                    <div class="feature-v">
                        <i class="fa-solid fa-tower-broadcast icon-feature"></i>
                        <h4>Sensores ciudadanos</h4>
                        <p>Combina datos p√∫blicos con nodos de la comunidad.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section id="sobre" class="section-nosotros">
        <h2 class="section-title orange">Sobre nosotros...</h2>
        <p class="nosotros-desc">
            Somos un equipo joven y multidisciplinar dedicado a crear soluciones tecnol√≥gicas que mejoren la vida
            urbana.
        </p>
        <div class="nosotros-grid">
            <div class="nosotros-card">
                <i class="fa-solid fa-leaf icon-feature"></i>
                <p>Compromiso con la sostenibilidad y la mejora de la calidad del aire.</p>
            </div>
            <div class="nosotros-card">
                <i class="fa-solid fa-mobile-screen icon-feature"></i>
                <p>Tecnolog√≠a accesible para ciudadanos, empresas y administraciones.</p>
            </div>
            <div class="nosotros-card">
                <i class="fa-solid fa-pen-ruler icon-feature"></i>
                <p>Dise√±o centrado en el usuario, simple y educativo.</p>
            </div>
            <div class="nosotros-card">
                <i class="fa-solid fa-database icon-feature"></i>
                <p>Integraci√≥n real de datos procedentes de sensores p√∫blicos y comunitarios.</p>
            </div>
            <div class="nosotros-card">
                <i class="fa-solid fa-lightbulb icon-feature"></i>
                <p>Innovaci√≥n continua, basada en ciencia y desarrollo colaborativo.</p>
            </div>
        </div>
        <div class="nosotros-cta">
            <p>¬øTe animas en participar en este proyecto?</p>
            <button class="btn-signup"
                onclick="window.location.href='https://sagucre.upv.edu.es/descarga/';">Apuntate!</button>
        </div>
    </section>


    <footer id="contacto" class="contact-section">
        <div class="contact-wrapper">
            <div class="contact-left">
                <h2 class="contact-title">¬°Cont√°ctanos!</h2>
                <p class="contact-phone">Tel: +34 965 258 736</p>
                <p class="contact-text">Puedes escribirnos desde aqu√≠:</p>
                <ul class="contact-list">
                    <li>info@airowalk.com</li>
                    <li>soporte@airowalk.com</li>
                    <li>ciudadanos@airowalk.com</li>
                </ul>
                <img src="https://sagucre.upv.edu.es/images/120/21601990/LogoGeneralitatValenciana-8bgziSb98SaymNPrT6-J0Q.png"
                    class="contact-ayto" alt="Generalitat Valenciana">
            </div>

            <div class="contact-right">
                <p class="map-label">Nos puedes encontrar aqu√≠:</p>
                <div class="contact-map-container">
                    <iframe
                        src="https://www.google.com/maps/d/u/0/embed?mid=1spTiPv9xRZlerME3lZ-nqjVBqlVtxdk&ehbc=2E312F"
                        width="100%" height="100%" frameborder="0" style="border:0;" allowfullscreen></iframe>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <img src="https://sagucre.upv.edu.es/images/260/21639371/Diagramadesitioweb2-tzmgvOszHG8SDcflHZ0HZw.png"
                class="footer-logo" alt="Logo">
            <div class="footer-links">
                <a href="#maps">Mapa</a>
                <a href="#producto">Producto</a>
                <a href="#contacto">Contacto</a>
            </div>
            <button class="btn-download" onclick="window.location.href='https://sagucre.upv.edu.es/descarga/';">Descarga
                la app</button>
        </div>
    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>


    <script>
// --- 1. CONFIGURACI√ìN Y ESTADO ---
const gasInfoData = {
    "AirQuality": {
        title: "Calidad del Aire General",
        text: `<p>√çndice global basado en el contaminante m√°s desfavorable detectado en este intervalo de tiempo.</p>`
    },
    "O3": { title: "Ozono Troposf√©rico (O‚ÇÉ)", text: `<p>Concentraci√≥n de O‚ÇÉ en ¬µg/m¬≥.</p>` },
    "CO": { title: "Mon√≥xido de Carbono (CO)", text: `<p>Concentraci√≥n de CO en ppm.</p>` },
    "NO2": { title: "Di√≥xido de Nitr√≥geno (NO‚ÇÇ)", text: `<p>Concentraci√≥n de NO‚ÇÇ en ¬µg/m¬≥.</p>` }
};

const map = L.map('map').setView([38.9707, -0.1800], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

let rawData = []; 
let interpolationLayer = null;
const layersPoints = { "CO": L.layerGroup(), "O3": L.layerGroup(), "NO2": L.layerGroup(), "AirQuality": L.layerGroup() };
const gasColors = { "co": "#FF4136", "o3": "#0074D9", "no2": "#2ECC40" };

// --- 2. FUNCIONES DE APOYO (HELPERS) ---

function getColor(val, type) {
    if (type === 'CO') {
        return val < 0.5 ? "#00FF00" : val < 1.0 ? "#FFFF00" : val < 2.0 ? "#FFA500" : "#FF0000";
    }
    // Escala para O3, NO2 y AirQuality (0-100)
    return val < 40 ? "#00FF00" : val < 70 ? "#FFFF00" : val < 90 ? "#FFA500" : "#FF0000";
}

function normalize(value, maxExpected) { 
    return Math.min(1, parseFloat(value || 0) / maxExpected); 
}

// --- 3. PROCESADOR DE DATOS (CEREBRO) ---

function getValidPoints(type) {
    return rawData
        .filter(d => {
            const hasCoords = d.latitude != null && d.longitude != null && 
                              !isNaN(parseFloat(d.latitude)) && !isNaN(parseFloat(d.longitude));
            if (type === "AirQuality") return hasCoords;
            return hasCoords && d[`${type.toLowerCase()}_value`] != null;
        })
        .map(d => {
            let val;
            if (type === "AirQuality") {
                // C√°lculo del √≠ndice global (0-100)
                val = Math.max(
                    normalize(d.co_value, 2), 
                    normalize(d.o3_value, 100), 
                    normalize(d.no2_value, 100)
                ) * 100;
            } else {
                val = parseFloat(d[`${type.toLowerCase()}_value`]);
            }
            return turf.point([parseFloat(d.longitude), parseFloat(d.latitude)], { val: val });
        });
}

// --- 4. GENERADOR DE INTERPOLACI√ìN ---

function updateMap(type) {
    // A. Limpieza de capas previas
    if (interpolationLayer) map.removeLayer(interpolationLayer);
    Object.values(layersPoints).forEach(l => map.removeLayer(l));

    // B. Obtener puntos limpios
    const points = getValidPoints(type);
    if (points.length < 2) {
        console.warn("Datos insuficientes para interpolar:", type);
        layersPoints[type].addTo(map); // Mostrar al menos los puntos si existen
        return;
    }

    // C. Ejecutar Interpolaci√≥n IDW
    try {
        const collection = turf.featureCollection(points);
        const options = { gridType: 'hex', property: 'val', units: 'kilometers', weight: 1.8 };    

        // cellSize: 0.05 km es ideal para ciudades sin colgar el navegador
        const grid = turf.interpolate(collection, 0.1, options);

        interpolationLayer = L.geoJson(grid, {
            style: (feature) => {
                return {
                    fillColor: getColor(feature.properties.val, type),
                    fillOpacity: 0.7,    // Un poco m√°s opaco para que se vea s√≥lido
                    weight: 0.0,         // Grosor del borde del cuadrado
                    color: 'rgba(0,0,0,0.2)', // Color del borde (gris transl√∫cido para ver la rejilla)
                    // Si no quieres bordes, pon weight: 0
                };
            }
        }).addTo(map);

    } catch (e) {
        console.error("Error en proceso de interpolaci√≥n:", e);
    }
}

// --- 5. GESTOR DE UI Y EVENTOS ---

function showLayer(type, btnElement) {
    updateMap(type);

    // Actualizar botones
    if (btnElement) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btnElement.classList.add('active');
    }

    // Actualizar Textos
    const info = gasInfoData[type];
    document.getElementById('gas-title').textContent = info.title;
    document.getElementById('gas-text').innerHTML = info.text;
}

// --- 6. CARGA INICIAL (FETCHER) ---

async function init() {
    try {
        const response = await fetch('https://api.sagucre.upv.edu.es/measurements');
        const data = await response.json();
        rawData = data.measurements || [];

        if (rawData.length === 0) return console.error("Snapshot vac√≠o");

        // Pre-cargar los LayerGroups de puntos reales
        rawData.forEach(d => {
            const lat = parseFloat(d.latitude);
            const lng = parseFloat(d.longitude);
            if (isNaN(lat) || isNaN(lng)) return;

            if (d.co_value != null) {
                layersPoints.CO.addLayer(L.circleMarker([lat, lng], { radius: 4, fillColor: gasColors.co, color: '#000', weight: 1, fillOpacity: 1 }));
            }
            if (d.o3_value != null) {
                layersPoints.O3.addLayer(L.circleMarker([lat, lng], { radius: 4, fillColor: gasColors.o3, color: '#000', weight: 1, fillOpacity: 1 }));
            }
            if (d.no2_value != null) {
                layersPoints.NO2.addLayer(L.circleMarker([lat, lng], { radius: 4, fillColor: gasColors.no2, color: '#000', weight: 1, fillOpacity: 1 }));
            }
            // AirQuality usa c√≠rculos blancos con borde del color de calidad
            const aqVal = Math.max(normalize(d.co_value, 2), normalize(d.o3_value, 100), normalize(d.no2_value, 100)) * 100;
            layersPoints.AirQuality.addLayer(L.circleMarker([lat, lng], { radius: 5, fillColor: '#FFF', color: getColor(aqVal, 'AirQuality'), weight: 3, fillOpacity: 1 }));
        });

        showLayer("AirQuality");

    } catch (err) {
        console.error("Error cargando el snapshot:", err);
    }
}

init();
    </script>
</body>

</html>  